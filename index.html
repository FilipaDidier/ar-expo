<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <script>
      AFRAME.registerComponent('pigment-particles', {
        init: function () {
          const el = this.el;
          const count = 55;
          const blues = ['#1a3a5c', '#2a5a8c', '#4a7fa5', '#1e4d6b', '#3b6e91', '#0d2a45'];

          for (let i = 0; i < count; i++) {
            const particle = document.createElement('a-sphere');

            // Start position — scattered across the blue area of the image
            const x = (Math.random() - 0.5) * 0.45;
            const y = (Math.random() - 0.5) * 0.35;
            const startZ = 0.0;

            // End position — drifts toward viewer and slightly wanders
            const endX = x + (Math.random() - 0.5) * 0.08;
            const endY = y + (Math.random() - 0.5) * 0.08;
            const endZ = 0.08 + Math.random() * 0.14;

            const size = 0.003 + Math.random() * 0.009;
            const duration = 2500 + Math.random() * 3500;
            const delay = Math.random() * 5000;
            const color = blues[Math.floor(Math.random() * blues.length)];

            particle.setAttribute('position', `${x} ${y} ${startZ}`);
            particle.setAttribute('radius', size);
            particle.setAttribute('color', color);
            particle.setAttribute('material', `transparent: true; opacity: 0; shader: flat`);

            // Move toward viewer
            particle.setAttribute('animation__move', `property: position; to: ${endX} ${endY} ${endZ}; dur: ${duration}; delay: ${delay}; loop: true; easing: easeOutSine`);
            // Fade in then out
            particle.setAttribute('animation__fadein', `property: material.opacity; from: 0; to: 0.85; dur: ${duration * 0.25}; delay: ${delay}; loop: true; easing: easeOutSine`);
            particle.setAttribute('animation__fadeout', `property: material.opacity; from: 0.85; to: 0; dur: ${duration * 0.35}; delay: ${delay + duration * 0.6}; loop: true; easing: easeInSine`);

            el.appendChild(particle);
          }
        }
      });
    </script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene
      mindar-image="imageTargetSrc: ./targets.mind; autoStart: true;"
      color-space="sRGB"
      renderer="colorManagement: true"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-entity mindar-image-target="targetIndex: 0">
        <a-entity pigment-particles></a-entity>
      </a-entity>

    </a-scene>
  </body>
</html>
